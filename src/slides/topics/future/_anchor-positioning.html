<section data-transition="convex">
  <section>
    <h2>CSS <mark>Anchor Positioning</mark></h2>
    <div class="baseline-badge limited">‚ùå Not in Baseline</div>
    <p class="fragment">Position elements relative to <mark>other elements</mark></p>
  </section>

  <section>
    <h3>The <mark>Problem</mark></h3>
    <div class="before-after" style="margin-top: 1.5rem;">
      <div class="before">
        <h4>‚ùå Before: JavaScript Calculations</h4>
        <div style="background: #f8fafc; padding: 2rem; border-radius: 0.75rem;">
          <pre><code class="language-javascript">// Calculate tooltip position
function positionTooltip(anchor, tooltip) {
  const rect = anchor.getBoundingClientRect();
  
  tooltip.style.top = 
    rect.bottom + 8 + 'px';
  tooltip.style.left = 
    rect.left + (rect.width / 2) + 'px';
  tooltip.style.transform = 
    'translateX(-50%)';
    
  // Handle viewport overflow
  // Recalculate on scroll/resize
  // ...100+ lines of edge cases
}</code></pre>
          <p style="margin: 1rem 0 0; font-size: 0.875rem; color: #64748b;">
            Complex, brittle, performance-heavy üòû
          </p>
        </div>
      </div>

      <div class="after">
        <h4>‚úÖ After: CSS Anchor Positioning</h4>
        <div style="background: #fef3c7; padding: 2rem; border-radius: 0.75rem;">
          <pre><code class="language-css">/* Define anchor */
.button {
  anchor-name: --my-button;
}

/* Position relative to anchor */
.tooltip {
  position: absolute;
  position-anchor: --my-button;
  
  top: anchor(bottom);
  left: anchor(center);
  translate: -50% 0;
  
  /* Auto-flip if overflow */
  position-try-fallbacks: flip-block;
}</code></pre>
          <p style="margin: 1rem 0 0; font-size: 0.875rem; color: #78350f;">
            Declarative, automatic, performant ‚ú®
          </p>
        </div>
      </div>
    </div>
  </section>

  <section>
    <h3>Core <mark>Concepts</mark></h3>
    <div style="display: grid; gap: 1.5rem; margin-top: 2rem; font-size: 0.85rem;">
      <div class="fragment" style="background: #fef3c7; padding: 1.5rem; border-radius: 0.75rem; border: 2px solid #fbbf24;">
        <h4 style="margin-top: 0; color: #92400e;">1. Define Anchor</h4>
        <pre><code class="language-css">/* Give element an anchor name */
.anchor-element {
  anchor-name: --my-anchor;
}

/* Can have multiple anchors */
.header {
  anchor-name: --header;
}

.sidebar {
  anchor-name: --sidebar;
}</code></pre>
      </div>

      <div class="fragment" style="background: #fef3c7; padding: 1.5rem; border-radius: 0.75rem; border: 2px solid #fbbf24;">
        <h4 style="margin-top: 0; color: #92400e;">2. Reference Anchor</h4>
        <pre><code class="language-css">/* Connect positioned element to anchor */
.positioned {
  position: absolute;
  position-anchor: --my-anchor;
  
  /* Or inline */
  top: anchor(--my-anchor bottom);
  left: anchor(--my-anchor left);
}</code></pre>
      </div>

      <div class="fragment" style="background: #fef3c7; padding: 1.5rem; border-radius: 0.75rem; border: 2px solid #fbbf24;">
        <h4 style="margin-top: 0; color: #92400e;">3. Position with anchor() Function</h4>
        <pre><code class="language-css">/* Available sides: top, bottom, left, right, center */
.tooltip {
  top: anchor(bottom);      /* Below anchor */
  left: anchor(center);     /* Centered horizontally */
  
  /* With offset */
  top: calc(anchor(bottom) + 8px);
  
  /* Percentage of anchor size */
  left: anchor(50%);        /* Center */
  top: anchor(25%);         /* Quarter way down */
}</code></pre>
      </div>
    </div>
  </section>

  <section>
    <h3>Automatic <mark>Fallbacks</mark></h3>
    <div style="display: grid; gap: 1.5rem; margin-top: 2rem; font-size: 0.85rem;">
      <div class="fragment" style="background: #fef3c7; padding: 1.5rem; border-radius: 0.75rem; border: 2px solid #fbbf24;">
        <h4 style="margin-top: 0; color: #92400e;">position-try-fallbacks</h4>
        <pre><code class="language-css">/* Define fallback positions */
.popover {
  position-anchor: --trigger;
  
  /* Primary position: below, centered */
  top: anchor(bottom);
  left: anchor(center);
  translate: -50% 0;
  
  /* If doesn't fit, try these in order */
  position-try-fallbacks:
    flip-block,        /* Try above instead */
    flip-inline,       /* Try left/right */
    flip-block flip-inline; /* Try opposite corner */
}</code></pre>
      </div>

      <div class="fragment" style="background: #fef3c7; padding: 1.5rem; border-radius: 0.75rem; border: 2px solid #fbbf24;">
        <h4 style="margin-top: 0; color: #92400e;">Custom Fallback Positions</h4>
        <pre><code class="language-css">/* Define custom position options */
@position-try --bottom-center {
  top: anchor(bottom);
  left: anchor(center);
  translate: -50% 0;
}

@position-try --top-center {
  bottom: anchor(top);
  left: anchor(center);
  translate: -50% 0;
}

@position-try --right-middle {
  left: anchor(right);
  top: anchor(center);
  translate: 0 -50%;
}

.tooltip {
  position-anchor: --button;
  position-try-fallbacks:
    --bottom-center,
    --top-center,
    --right-middle;
}</code></pre>
      </div>

      <div class="fragment" style="background: #e0e7ff; padding: 1.5rem; border-radius: 0.75rem; border: 2px solid #667eea;">
        <h4 style="margin-top: 0; color: #3730a3;">üéØ Browser Automatically Chooses</h4>
        <p style="margin: 0.5rem 0 0; color: #4338ca;">
          The browser tests each fallback and uses the first one where the element fully fits in the viewport.
          No JavaScript needed!
        </p>
      </div>
    </div>
  </section>

  <section>
    <h3>Use <mark>Cases</mark></h3>
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-top: 2rem; font-size: 0.85rem;">
      <div class="fragment" style="background: white; padding: 1.5rem; border-radius: 0.75rem; border: 2px solid #e2e8f0;">
        <h4 style="margin-top: 0; color: #0f172a;">üí¨ Tooltips & Popovers</h4>
        <pre><code class="language-css">.tooltip {
  position-anchor: --trigger;
  top: anchor(bottom);
  left: anchor(center);
  translate: -50% 8px;
  position-try-fallbacks: flip-block;
}</code></pre>
      </div>

      <div class="fragment" style="background: white; padding: 1.5rem; border-radius: 0.75rem; border: 2px solid #e2e8f0;">
        <h4 style="margin-top: 0; color: #0f172a;">üìã Dropdown Menus</h4>
        <pre><code class="language-css">.dropdown {
  position-anchor: --menu-button;
  top: anchor(bottom);
  left: anchor(left);
  position-try-fallbacks:
    flip-block, flip-inline;
}</code></pre>
      </div>

      <div class="fragment" style="background: white; padding: 1.5rem; border-radius: 0.75rem; border: 2px solid #e2e8f0;">
        <h4 style="margin-top: 0; color: #0f172a;">üè∑Ô∏è Floating Labels</h4>
        <pre><code class="language-css">.label {
  position-anchor: --input;
  bottom: anchor(top);
  left: anchor(left);
}</code></pre>
      </div>

      <div class="fragment" style="background: white; padding: 1.5rem; border-radius: 0.75rem; border: 2px solid #e2e8f0;">
        <h4 style="margin-top: 0; color: #0f172a;">üìå Annotation Markers</h4>
        <pre><code class="language-css">.marker {
  position-anchor: --highlight;
  top: anchor(top);
  left: anchor(right);
  translate: 8px -50%;
}</code></pre>
      </div>
    </div>
  </section>

  <section>
    <h3>Browser <mark>Support</mark></h3>
    <div style="display: grid; gap: 1.5rem; margin-top: 2rem; font-size: 0.85rem;">
      <div class="fragment" style="background: #fef2f2; padding: 1.5rem; border-radius: 0.75rem; border: 2px solid #ef4444;">
        <h4 style="margin-top: 0; color: #dc2626;">‚ùå Not in Baseline - Limited Support</h4>
        <p style="margin: 0.5rem 0 0; color: #991b1b;">
          <strong>Chrome/Edge 125+</strong> (behind flag: <code>chrome://flags/#enable-experimental-web-platform-features</code>)<br>
          Firefox & Safari: Under development
        </p>
      </div>

      <div class="fragment" style="background: #fef3c7; padding: 1.5rem; border-radius: 0.75rem; border: 2px solid #fbbf24;">
        <h4 style="margin-top: 0; color: #92400e;">üîß Polyfill Available</h4>
        <pre><code class="language-html">&lt;script type="module"&gt;
  if (!CSS.supports('anchor-name', '--test')) {
    import('https://unpkg.com/@oddbird/css-anchor-positioning');
  }
&lt;/script&gt;</code></pre>
        <p style="margin: 0.5rem 0 0; font-size: 0.875rem; color: #78350f;">
          <a href="https://github.com/oddbird/css-anchor-positioning" style="color: #d97706;">@oddbird/css-anchor-positioning</a>
        </p>
      </div>

      <div class="fragment" style="background: #e0e7ff; padding: 1.5rem; border-radius: 0.75rem; border: 2px solid #667eea;">
        <h4 style="margin-top: 0; color: #3730a3;">üöÄ Progressive Enhancement</h4>
        <pre><code class="language-css">/* Fallback positioning */
.tooltip {
  position: absolute;
  top: 100%;
  left: 50%;
  transform: translateX(-50%);
}

/* Enhanced with anchor positioning */
@supports (anchor-name: --test) {
  .anchor {
    anchor-name: --tooltip-anchor;
  }
  
  .tooltip {
    position-anchor: --tooltip-anchor;
    top: anchor(bottom);
    left: anchor(center);
    translate: -50% 0;
    transform: none;
  }
}</code></pre>
      </div>

      <div class="fragment" style="background: #d1fae5; padding: 1.5rem; border-radius: 0.75rem; border: 2px solid #10b981;">
        <h4 style="margin-top: 0; color: #065f46;">üîÆ Future is Bright</h4>
        <p style="margin: 0.5rem 0 0; color: #047857;">
          This will eliminate thousands of lines of tooltip/popover positioning JavaScript.
          Watch for Baseline availability in 2026!
        </p>
      </div>
    </div>
  </section>
</section>
