<section data-transition="convex">
  <section>
    <h2>Popover API</h2>
    <div class="baseline-badge newly">üü° Newly Available (gen 2025)</div>
    <p class="fragment">Native <mark>tooltips & menus</mark></p>
  </section>

  <section>
    <h3>Before: <mark>JavaScript Everywhere</mark></h3>
    <div class="before-after">
      <div class="before">
        <h4>‚ùå Complex Setup</h4>
        <pre><code class="language-html">&lt;button id="btn"&gt;Show Tooltip&lt;/button&gt;
&lt;div id="tooltip" class="hidden"&gt;
  Tooltip content
&lt;/div&gt;</code></pre>
        <pre><code class="language-javascript">// Toggle visibility
btn.addEventListener('click', () => {
  tooltip.classList.toggle('hidden');
});

// Position near button
const rect = btn.getBoundingClientRect();
tooltip.style.top = rect.bottom + 'px';
tooltip.style.left = rect.left + 'px';

// Close on outside click
document.addEventListener('click', (e) => {
  if (!tooltip.contains(e.target)) {
    tooltip.classList.add('hidden');
  }
});

// Handle escape key, focus trap, etc...</code></pre>
      </div>

      <div class="after">
        <h4>‚úÖ Declarative Popover</h4>
        <pre><code class="language-html">&lt;button popovertarget="my-tooltip"&gt;
  Show Tooltip
&lt;/button&gt;

&lt;div id="my-tooltip" popover&gt;
  Tooltip content
&lt;/div&gt;

&lt;!-- That's it! 
  - Auto-positioning in top layer
  - Light dismiss (click outside)
  - Escape key closes
  - Focus management
  - Accessibility built-in
--&gt;</code></pre>
        <pre><code class="language-css">/* Style the popover */
[popover] {
  border: none;
  padding: 1rem;
  border-radius: 0.5rem;
  box-shadow: 0 4px 6px rgba(0,0,0,0.1);
}

[popover]::backdrop {
  background: rgba(0, 0, 0, 0.3);
}</code></pre>
      </div>
    </div>
  </section>

  <section>
    <h3>Popover <mark>Types</mark></h3>
    <div style="display: grid; gap: 1.5rem; margin-top: 2rem; font-size: 0.85rem;">
      <div class="fragment" style="background: #fef3c7; padding: 1.5rem; border-radius: 0.75rem; border: 2px solid #fbbf24;">
        <h4 style="margin-top: 0; color: #92400e;">üîÑ Auto (default)</h4>
        <pre><code class="language-html">&lt;div popover&gt; &lt;!-- or popover="auto" --&gt;
  Light dismiss: closes on outside click
  Only one auto popover at a time
&lt;/div&gt;</code></pre>
      </div>

      <div class="fragment" style="background: #fef3c7; padding: 1.5rem; border-radius: 0.75rem; border: 2px solid #fbbf24;">
        <h4 style="margin-top: 0; color: #92400e;">üìå Manual</h4>
        <pre><code class="language-html">&lt;div popover="manual"&gt;
  Doesn't auto-close on outside click
  Must be closed explicitly
  Multiple can be open
&lt;/div&gt;</code></pre>
      </div>
    </div>
  </section>

  <section>
    <h3>Interactive <mark>Demo</mark></h3>
    <div class="demo" style="margin-top: 2rem;">
      <div style="display: flex; gap: 2rem; justify-content: center; align-items: start;">
        <div>
          <h4 style="margin-top: 0;">Auto Popover (Tooltip)</h4>
          <button popovertarget="demo-tooltip" style="padding: 0.75rem 1.5rem; background: #667eea; color: white; border: none; border-radius: 0.5rem; cursor: pointer; font-weight: 600;">
            Show Tooltip
          </button>
          
          <div id="demo-tooltip" popover style="margin: 0; border: none; padding: 1rem 1.5rem; border-radius: 0.5rem; background: #1f2937; color: white; box-shadow: 0 4px 6px rgba(0,0,0,0.2);">
            üëã This is a tooltip!<br>
            <span style="font-size: 0.875rem; opacity: 0.8;">Click outside or press Esc to close</span>
          </div>
        </div>

        <div>
          <h4 style="margin-top: 0;">Manual Popover (Menu)</h4>
          <button popovertarget="demo-menu" style="padding: 0.75rem 1.5rem; background: #10b981; color: white; border: none; border-radius: 0.5rem; cursor: pointer; font-weight: 600;">
            Open Menu
          </button>
          
          <div id="demo-menu" popover="manual" style="margin: 0; border: none; padding: 0; border-radius: 0.5rem; background: white; box-shadow: 0 4px 6px rgba(0,0,0,0.1); min-width: 200px;">
            <button onclick="this.closest('[popover]').hidePopover(); alert('Action 1')" style="width: 100%; padding: 0.75rem 1rem; background: transparent; border: none; text-align: left; cursor: pointer; border-bottom: 1px solid #e2e8f0;">
              Action 1
            </button>
            <button onclick="this.closest('[popover]').hidePopover(); alert('Action 2')" style="width: 100%; padding: 0.75rem 1rem; background: transparent; border: none; text-align: left; cursor: pointer; border-bottom: 1px solid #e2e8f0;">
              Action 2
            </button>
            <button popovertarget="demo-menu" popovertargetaction="hide" style="width: 100%; padding: 0.75rem 1rem; background: transparent; border: none; text-align: left; cursor: pointer; color: #ef4444; font-weight: 600;">
              Close
            </button>
          </div>
        </div>
      </div>

      <div style="margin-top: 2rem; padding: 1.5rem; background: #f8fafc; border-radius: 0.75rem; border: 2px solid #e2e8f0; font-size: 0.9rem;">
        <h4 style="margin: 0 0 1rem;">‚ú® Built-in Features:</h4>
        <ul style="margin: 0; padding-left: 1.5rem; color: #64748b;">
          <li>Renders in top layer (above everything)</li>
          <li>Light dismiss (auto popovers)</li>
          <li>Escape key handling</li>
          <li>Focus management</li>
          <li>ARIA attributes automatic</li>
        </ul>
      </div>
    </div>
  </section>

  <section>
    <h3>Popover <mark>Controls</mark></h3>
    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem; margin-top: 2rem; font-size: 0.85rem;">
      <div class="fragment" style="background: #fef3c7; padding: 1.5rem; border-radius: 0.75rem; border: 2px solid #fbbf24;">
        <h4 style="margin-top: 0; color: #92400e;">HTML Controls</h4>
        <pre><code class="language-html">&lt;!-- Toggle --&gt;
&lt;button popovertarget="my-popover"&gt;
  Toggle
&lt;/button&gt;

&lt;!-- Explicit actions --&gt;
&lt;button 
  popovertarget="my-popover" 
  popovertargetaction="show"&gt;
  Show
&lt;/button&gt;

&lt;button 
  popovertarget="my-popover" 
  popovertargetaction="hide"&gt;
  Hide
&lt;/button&gt;</code></pre>
      </div>

      <div class="fragment" style="background: #fef3c7; padding: 1.5rem; border-radius: 0.75rem; border: 2px solid #fbbf24;">
        <h4 style="margin-top: 0; color: #92400e;">JavaScript API</h4>
        <pre><code class="language-javascript">const popover = document.getElementById('my-popover');

// Methods
popover.showPopover();
popover.hidePopover();
popover.togglePopover();

// Events
popover.addEventListener('beforetoggle', (e) => {
  console.log('State:', e.newState); // 'open' or 'closed'
});

popover.addEventListener('toggle', (e) => {
  console.log('Toggled!');
});</code></pre>
      </div>
    </div>
  </section>

  <section>
    <h3>Use Cases & <mark>Styling</mark></h3>
    <div class="code-demo-split">
      <div class="code-example">
        <pre><code class="language-css">/* Anchor positioning hint (future) */
[popover] {
  /* Position near trigger button */
  position: fixed;
  inset: auto;
  margin: 0;
}

/* Popover states */
[popover]:popover-open {
  /* Styles when open */
  opacity: 1;
  transform: scale(1);
}

/* Backdrop */
[popover]::backdrop {
  background: rgba(0, 0, 0, 0.5);
  backdrop-filter: blur(4px);
}

/* Animations */
[popover] {
  opacity: 0;
  transform: scale(0.9);
  transition: 
    opacity 0.2s,
    transform 0.2s,
    overlay 0.2s allow-discrete,
    display 0.2s allow-discrete;
}

[popover]:popover-open {
  opacity: 1;
  transform: scale(1);
}</code></pre>
      </div>

      <div class="code-example">
        <pre><code class="language-html">&lt;!-- Common patterns --&gt;

&lt;!-- Tooltip --&gt;
&lt;button popovertarget="tip"&gt;?&lt;/button&gt;
&lt;div id="tip" popover role="tooltip"&gt;
  Help text
&lt;/div&gt;

&lt;!-- Dropdown menu --&gt;
&lt;button popovertarget="menu"&gt;Menu&lt;/button&gt;
&lt;div id="menu" popover role="menu"&gt;
  &lt;button role="menuitem"&gt;Option 1&lt;/button&gt;
  &lt;button role="menuitem"&gt;Option 2&lt;/button&gt;
&lt;/div&gt;

&lt;!-- Modal dialog (use &lt;dialog&gt; instead) --&gt;
&lt;!-- Popover is for light UI, not modals --&gt;

&lt;!-- Nested popovers --&gt;
&lt;div id="parent" popover&gt;
  &lt;button popovertarget="child"&gt;More&lt;/button&gt;
  &lt;div id="child" popover&gt;
    Nested content
  &lt;/div&gt;
&lt;/div&gt;</code></pre>
      </div>
    </div>
  </section>
</section>
